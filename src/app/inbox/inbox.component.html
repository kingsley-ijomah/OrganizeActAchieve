<div class="inbox-container">
  <header class="inbox-header">
    <div>
      <h1 class="inbox-title">Inbox</h1>
      <span class="item-count-badge">{{ inboxItems.length }} items</span>
    </div>
    <button class="filter-link" type="button" (click)="openFilter()" *ngIf="!hasSelectedItems">Filter</button>
  </header>

  <div class="selection-bar" *ngIf="hasSelectedItems">
    <span class="selection-count">{{ selectedCount }} selected</span>
    <div class="selection-actions">
      <button class="selection-btn delete-btn" type="button" (click)="deleteSelectedItems()" aria-label="Delete selected">
        <span class="material-icons">delete</span>
        <span>Delete</span>
      </button>
      <button class="selection-btn cancel-btn" type="button" (click)="clearSelection()" aria-label="Clear selection">
        <span class="material-icons">close</span>
        <span>Cancel</span>
      </button>
    </div>
  </div>

  <div class="inbox-list-container">
    <ul class="inbox-list">
      <app-task-item
        *ngFor="let item of displayedItems"
        [item]="item"
        [isEditing]="isEditing(item.id)"
        [isSelected]="isSelected(item.id)"
        (edit)="startEdit($event)"
        (delete)="deleteItem($event)"
        (toggleSelect)="toggleSelect($event)"
        (save)="saveEdit($event)"
        (cancel)="cancelEdit()"
        (select)="openProjectSelector($event)"
      ></app-task-item>
    </ul>
    
    <app-load-more-button
      [hasMore]="hasMoreItems"
      [remainingCount]="remainingCount"
      (loadMore)="loadMore()"
    ></app-load-more-button>
  </div>

  <app-project-selector
    [isOpen]="showProjectSelector"
    [selectedItem]="selectedItem"
    [projects]="projects"
    (close)="closeProjectSelector()"
    (selectProject)="selectProject($event)"
  ></app-project-selector>

  <app-convert-or-add-modal
    [isOpen]="showConvertOrAdd"
    [taskTitle]="selectedItem?.title || ''"
    (close)="closeConvertOrAdd()"
    (convertToProject)="handleConvertToProject()"
    (addToProject)="handleAddToProject()"
  ></app-convert-or-add-modal>

  <app-task-details-modal
    [isOpen]="showTaskDetails"
    [taskTitle]="selectedItem?.title || ''"
    (close)="closeTaskDetails()"
    (save)="saveTaskDetails($event)"
  ></app-task-details-modal>

  <app-confirm-modal
    [isOpen]="showConfirmDelete"
    title="Delete item?"
    message="This will permanently remove the item from your Inbox."
    confirmLabel="Delete"
    cancelLabel="Cancel"
    (confirm)="confirmDelete()"
    (cancel)="cancelDelete()"
  ></app-confirm-modal>

  <app-confirm-modal
    [isOpen]="showConfirmBulkDelete"
    [title]="'Delete ' + selectedCount + ' item' + (selectedCount > 1 ? 's' : '') + '?'"
    message="This will permanently remove the selected item(s) from your Inbox."
    confirmLabel="Delete"
    cancelLabel="Cancel"
    (confirm)="confirmBulkDelete()"
    (cancel)="cancelBulkDelete()"
  ></app-confirm-modal>

  <router-outlet></router-outlet>
</div>

<app-list-filter 
  [value]="filter" 
  [isOpen]="showFilter"
  (change)="onFilterChange($event)"
  (close)="closeFilter()"
></app-list-filter>

<app-inbox-capture
  [isVisible]="showCapture"
  (add)="addItem($event)"
  (close)="closeCapture()"
></app-inbox-capture>

<button class="fab-inbox" type="button" (click)="openCapture()" *ngIf="!showCapture" aria-label="Capture new item">
  <span class="material-icons">add</span>
</button>
