<div class="inbox-container">
  <header class="inbox-header">
    <h1 class="inbox-title">Inbox</h1>
  </header>
  
  <div class="inbox-input-row">
    <input 
      class="inbox-input" 
      placeholder="Capture a new item…" 
      type="text"
      [(ngModel)]="newItemText"
    />
    <button class="icon-btn mic-btn" type="button" aria-label="Record voice">
      <span class="material-icons">mic</span>
    </button>
    <button class="icon-btn add-btn" type="button" aria-label="Add item">
      <span class="material-icons">add</span>
    </button>
  </div>
  
  <button 
    class="show-list-btn" 
    type="button"
    (click)="toggleList()"
    [attr.aria-expanded]="showList"
    aria-label="Toggle inbox items list"
  >
    <span class="material-icons">{{ showList ? 'expand_less' : 'expand_more' }}</span>
    <span class="btn-text">{{ showList ? 'Hide Items' : 'Show Items' }}</span>
    <span class="item-count">{{ inboxItems.length }}</span>
  </button>

  <div class="inbox-list-container" *ngIf="showList">
    <ul class="inbox-list">
      <li 
        *ngFor="let item of displayedItems" 
        class="inbox-item" 
        [class.editing]="isEditing(item.id)"
        (click)="openProjectSelector(item, $event)"
      >
        <button class="item-checkbox" type="button" aria-label="Toggle task completion" *ngIf="!isEditing(item.id)">
          <span class="material-icons checkbox-icon">radio_button_unchecked</span>
        </button>
        
        <div class="item-content" *ngIf="!isEditing(item.id)">
          <span class="item-title">{{ item.title }}</span>
          <div class="item-actions">
            <button class="action-btn edit-btn" type="button" (click)="startEdit(item, $event)" aria-label="Edit task">
              <span class="material-icons">edit</span>
            </button>
            <button class="action-btn delete-btn" type="button" (click)="deleteItem(item.id, $event)" aria-label="Delete task">
              <span class="material-icons">delete</span>
            </button>
          </div>
        </div>

        <div class="item-edit" *ngIf="isEditing(item.id)">
          <input 
            class="edit-input" 
            type="text" 
            [(ngModel)]="editingItemText"
            (keydown.enter)="saveEdit()"
            (keydown.escape)="cancelEdit()"
            #editInput
          />
          <div class="edit-actions">
            <button class="action-btn save-btn" type="button" (click)="saveEdit()" aria-label="Save changes">
              <span class="material-icons">check</span>
            </button>
            <button class="action-btn cancel-btn" type="button" (click)="cancelEdit()" aria-label="Cancel editing">
              <span class="material-icons">close</span>
            </button>
          </div>
        </div>
      </li>
    </ul>
    
    <button 
      class="load-more-btn" 
      type="button"
      *ngIf="hasMoreItems"
      (click)="loadMore()"
      aria-label="Load more items"
    >
      <span class="load-more-text">Load More</span>
      <span class="load-more-count">({{ remainingCount }} remaining)</span>
      <span class="material-icons">expand_more</span>
    </button>
  </div>

  <!-- Project Selector Modal -->
  <div class="modal-overlay" *ngIf="showProjectSelector" (click)="closeProjectSelector()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Add to Project</h2>
        <button class="modal-close-btn" type="button" (click)="closeProjectSelector()" aria-label="Close">
          <span class="material-icons">close</span>
        </button>
      </div>
      
      <div class="task-preview" *ngIf="selectedItem">
        <span class="material-icons">description</span>
        <span class="task-preview-text">{{ selectedItem.title }}</span>
      </div>

      <div class="project-search-wrapper">
        <span class="material-icons search-icon">search</span>
        <input 
          class="project-search-input" 
          type="text"
          placeholder="Search projects…"
          [(ngModel)]="projectSearchQuery"
          (click)="$event.stopPropagation()"
        />
        <button 
          class="clear-search-btn" 
          type="button"
          *ngIf="projectSearchQuery"
          (click)="projectSearchQuery = ''"
          aria-label="Clear search"
        >
          <span class="material-icons">close</span>
        </button>
      </div>

      <div class="projects-list">
        <div 
          *ngFor="let project of filteredProjects" 
          class="project-select-item"
          (click)="selectProject(project)"
        >
          <div class="project-select-info">
            <h3 class="project-select-name">{{ project.name }}</h3>
            <div class="project-select-stats">
              <span class="project-task-count">{{ project.totalTasks }} tasks</span>
            </div>
          </div>
          <span class="material-icons">chevron_right</span>
        </div>
        
        <div class="no-projects" *ngIf="filteredProjects.length === 0">
          <span class="material-icons">folder</span>
          <p>No projects found</p>
        </div>
      </div>
    </div>
  </div>

  <router-outlet></router-outlet>
</div>
